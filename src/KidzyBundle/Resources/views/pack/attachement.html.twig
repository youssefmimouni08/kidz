{% extends 'base.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('back/assets/css/attachment.css') }}" rel="stylesheet"/>
    <link href="{{ asset('back/assets/libs/dropify/dropify.min.css') }}" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.css" integrity="sha256-e47xOkXs1JXFbjjpoRr1/LhVcqSzRmGmPqsrUQeVs+g=" crossorigin="anonymous" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/css/iziToast.min.css"/>


    <!-- App css -->

{% endblock %}
{% block content %}
    <section class="section bg-gradient" id="home" style="background: linear-gradient(to top, #ffe6ee, #ffe2eb, #ffdee8, #ffdae4, #ffd6e1, #fed2dd, #fecfda, #fdcbd6, #fbc6d1, #fac1cd, #f8bdc8, #f6b8c3); padding-bottom: 10px !important">
    </section>
    <div class="container-fluid" style="padding-top: 70px !important;">

        <!-- start page title -->
        <div class="row">
            <div class="col-12">
                <div class="page-title-box">
                    <h4 class="page-title">Taskdetail</h4>
                </div>
            </div>
        </div>
        <!-- end page title -->

        <div class="row">
            {% for enfant in parent.enfants %}
            <div class="col-md-8">
                <div class="card-box task-detail">

                    <div class="media mb-3">
                        <img class="d-flex mr-3 rounded-circle avatar-md" alt="64x64" src="{{ vich_uploader_asset(enfant ,'imageFile') | imagine_filter('thumb') }}">
                        <div class="media-body">
                            <h4 class="media-heading mt-0">{{ enfant.nomEnfant }} {{ enfant.prenomEnfant }}</h4>
                            <span class="badge badge-danger">Urgent</span>
                        </div>
                    </div>
                    {% if enfant.getFactures|length > 0 %}
                    {% for facture in enfant.getFactures %}
                    <h4>{{ facture.pack.nomPack  }}</h4>


                    <div class="row task-dates mb-0 mt-2">
                        <div class="col-lg-6">
                            <h5 class="font-600 m-b-5">Start Date</h5>
                            <p> {{facture.dateFacture |localizeddate('none', 'none', app.request.locale, "Europe/Paris", "cccc d MMMM Y") }} <small class="text-muted"></small></p>
                        </div>

                        <div class="col-lg-6">
                            <h5 class="font-600 m-b-5">Due Date</h5>
                            <p> {{facture.due_dateFacture |localizeddate('none', 'none', app.request.locale, "Europe/Paris", "cccc d MMMM Y") }} <small class="text-muted"></small></p>
                        </div>
                    </div>
                    {% endfor %}
                    {% else  %}
                        pokp
                    {% endif %}
                    <div class="clearfix"></div>



                    <div class="attached-files mt-4">
                        <h6>Liste des documents à fournir obligatoirement lors de l’inscription </h6>
                        <div class="row">
                            <div class="col-sm-4">
                            <div id="container" class="row col-sm-10 col-sm-offset-1">

                                <div class="form-group">
                                    <label class="col-sm-2 control-label required" for="">Add Image</label>
                                    <div class="col-sm-10">
                                        <div class="dropzone " id="certificat{{ enfant.idenfant }}"></div>  {# This is the element which is used as a dropzone #}
                                    </div>
                                </div>

                                <input type="hidden" id="linked_ID">
                                <input type="hidden" id="fileName">
                            </div>
                            </div>
                            <!-- end col -->

                            <!-- end col -->

                            <!-- end col -->
                        </div>

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="text-right m-t-30">
                                    <button type="submit" class="btn btn-success waves-effect waves-light">
                                        Save
                                    </button>
                                    <button type="button" class="btn btn-light waves-effect">Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <h5>Progress <span class="text-success float-right">80%</span></h5>
                    <div class="progress progress-bar-alt-success progress-sm">
                        <div class="progress-bar bg-success progress-animated wow animated animated" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%; visibility: visible; animation-name: animationProgress;">
                        </div><!-- /.progress-bar .progress-bar-danger -->
                    </div>
                </div>
            </div><!-- end col -->
            {% endfor %}
            {#<div class="col-md-4">
                <div class="card-box">
                    <div class="dropdown float-right">
                        <a href="#" class="dropdown-toggle arrow-none card-drop" data-toggle="dropdown" aria-expanded="false">
                            <i class="mdi mdi-dots-vertical"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right">
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Action</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Another action</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Something else</a>
                            <!-- item-->
                            <a href="javascript:void(0);" class="dropdown-item">Separated link</a>
                        </div>
                    </div>

                    <h4 class="header-title mt-0 mb-3">Comments (6)</h4>

                    <div>

                        <div class="media mb-3">
                            <div class="d-flex mr-3">
                                <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-1.jpg"> </a>
                            </div>
                            <div class="media-body">
                                <h5 class="mt-0">Mat Helme</h5>
                                <p class="font-13 text-muted mb-0">
                                    <a href="" class="text-primary">@Michael</a>
                                    Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque
                                    ante sollicitudin commodo.
                                </p>
                                <a href="" class="text-success font-13">Reply</a>
                            </div>
                        </div>

                        <div class="media mb-3">
                            <div class="d-flex mr-3">
                                <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-2.jpg"> </a>
                            </div>
                            <div class="media-body">
                                <h5 class="mt-0">Media heading</h5>
                                <p class="font-13 text-muted mb-0">
                                    <a href="" class="text-primary">@Michael</a>
                                    Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque sollicitudin purus odio.
                                </p>
                                <a href="" class="text-success font-13">Reply</a>

                                <div class="media my-2">
                                    <div class="d-flex mr-3">
                                        <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-3.jpg"> </a>
                                    </div>
                                    <div class="media-body">
                                        <h5 class="mt-0">Nested media heading</h5>
                                        <p class="font-13 text-muted mb-0">
                                            <a href="" class="text-primary">@Michael</a>
                                            Cras sit amet nibh libero, in gravida nulla vel metus scelerisque ante sollicitudin purus odio.
                                        </p>
                                        <a href="" class="text-success font-13">Reply</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="media mb-3">
                            <div class="d-flex mr-3">
                                <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-1.jpg"> </a>
                            </div>
                            <div class="media-body">
                                <h5 class="mt-0">Mat Helme</h5>
                                <p class="font-13 text-muted mb-0">
                                    <a href="" class="text-primary">@Michael</a>
                                    Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque
                                    ante sollicitudin commodo cras purus.
                                </p>
                                <a href="" class="text-success font-13">Reply</a>
                            </div>
                        </div>

                        <div class="media mb-3">
                            <div class="d-flex mr-3">
                                <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-1.jpg"> </a>
                            </div>
                            <div class="media-body">
                                <h5 class="mt-0">Mat Helme</h5>
                                <p class="font-13 text-muted mb-0">
                                    <a href="" class="text-primary">@Michael</a>
                                    Cras sit amet nibh libero, in gravida nulla. Nulla vel metus scelerisque
                                    ante sollicitudin commodo cras.
                                </p>
                                <a href="" class="text-success font-13">Reply</a>
                            </div>
                        </div>

                        <div class="media mb-3">
                            <div class="d-flex mr-3">
                                <a href="#"> <img class="media-object rounded-circle avatar-sm" alt="64x64" src="assets/images/users/user-1.jpg"> </a>
                            </div>
                            <div class="media-body">
                                <input type="text" class="form-control input-sm" placeholder="Some text value...">
                            </div>
                        </div>

                    </div>
                </div>
            </div><!-- end col -->#}
        </div>
        <!-- end row -->
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <!-- Vendor js -->
    <script src="{{ asset('back/assets/js/vendor.min.js') }}"></script>

    <!-- plugin -->
    <script src="{{ asset('back/assets/libs/bootstrap-tagsinput/bootstrap-tagsinput.min.js') }}"></script>

    <!-- App js-->
    <script src="{{ asset('back/assets/js/app.min.js') }}"></script>
    <script src="{{ asset('back/assets/libs/dropify/dropify.min.js') }}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/izitoast/1.4.0/js/iziToast.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.5.1/min/dropzone.min.js" integrity="sha256-cs4thShDfjkqFGk5s2Lxj35sgSRr4MRcyccmi0WKqCM=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.0.min.js"></script>

    <script>

        // init,configure dropzone
        Dropzone.autoDiscover = false;
        {% for enfant in parent.enfants %}
        var dropzone_default = new Dropzone('#certificat{{ enfant.idenfant }}', {
            url: '{{ path('fileuploadhandler',{'idEnfant': enfant.idenfant}) }}' ,
            maxFiles: 1,
            dictMaxFilesExceeded: 'Only 1 Image can be uploaded',
            acceptedFiles: 'image/*',
            maxFilesize: 3,  // in Mb
            addRemoveLinks: true,
            init: function () {
                this.on("maxfilesexceeded", function(file) {
                    this.removeFile(file);
                });
                this.on("sending", function(file, xhr, formData) {
                    // send additional data with the file as POST data.
                    formData.append("key", "value");
                });
                this.on("success", function(file, response) {
                    iziToast.show({
                        title: 'Success!',
                        message: 'File Uploaded: <b>'+ response.originalFileName +'</b>.<br>Saved as ' + response.fileName +'<br>Inserted MediaEntity Id: <b>' + response.mediaEntityId +'</b>',
                        color: 'green',
                        position: 'topCenter'
                    });
                    // set the id,filename from the response
                    $('#fileName').val(response.fileName);
                    $('#linked_ID').val(response.mediaEntityId);

                });
                this.on("removedfile", function(file) {
                    var fileName = $('#fileName').val();
                    var linkedId = $('#linked_ID').val();

                    // Delete file from server
                    $.ajax({
                        type: 'POST',
                        url: '{{ path('deleteFileResource') }}',
                        data: {
                            id: linkedId,
                            fileName: fileName
                        },
                        dataType: 'json'
                    }).done(function (resp) {
                        if (resp.deleted) {
                            iziToast.show({
                                title: 'Deleted!',
                                message: 'Deleted File: <b>'+ fileName + '</b>.',
                                color: 'yellow',
                                position: 'topCenter'
                            });
                        } else if (resp.error) {
                            iziToast.show({
                                title: 'Error!',
                                message: resp.error,
                                color: 'red',
                                position: 'topCenter'
                            });
                        }
                    }).fail(function(resp) {
                        console.error('xhr failed', resp);
                        return false;
                    });
                });
                // this event is required only to debug errors
                this.on("error", function(file, errorMessage) {
                    console.error('Error', errorMessage);
                    iziToast.show({
                        title: 'Upload Failed',
                        message: errorMessage,
                        color: 'red',
                        position: 'topCenter'
                    });
                });
            }
        });
        {% endfor %}
    </script>
{% endblock %}
